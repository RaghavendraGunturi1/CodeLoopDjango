{% extends "codingapp/base.html" %}
{% block content %}
<h2>Department Groups</h2>

{% for block in groups %}
<div class="card mb-3">

  <div class="card-header bg-secondary text-white"
       data-bs-toggle="collapse"
       data-bs-target="#group{{ block.group.id }}"
       role="button"
       style="cursor:pointer">
    {{ block.group.name }}
  </div>

  <div id="group{{ block.group.id }}" class="collapse">
    <div class="card-body">

      <input type="text" class="form-control mb-2"
        placeholder="Search students"
        onkeyup="filterTable('{{ block.group.id }}', this.value)">

      <table class="table table-sm group-table"
             data-group="{{ block.group.id }}">
        <tbody>
          {% for entry in block.students %}
          <tr>
            <td class="student-name">{{ entry.student.username }}</td>
            <td>{{ entry.internal_score }}</td>
            <td>
              <a href="{% url 'student_performance_detail' entry.student.id %}">
                View
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>
</div>
{% endfor %}

<script>
function filterTable(id, q) {
  q = q.toLowerCase();
  document.querySelectorAll(
    `.group-table[data-group="${id}"] tr`
  ).forEach(row => {
    row.style.display =
      row.querySelector(".student-name")
         .innerText.toLowerCase()
         .includes(q) ? "" : "none";
  });
}
</script>
{% endblock %}
