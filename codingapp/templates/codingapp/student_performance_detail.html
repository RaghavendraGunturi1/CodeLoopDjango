{% extends "codingapp/base.html" %}
{% block content %}

<h2>Student Performance</h2>

<!-- ================= STUDENT INFO ================= -->
<div class="card mb-4">
  <div class="card-body">
    <h4>{{ student.get_full_name|default:student.username }}</h4>
    <p class="text-muted">{{ student.username }}</p>
  </div>
</div>

<!-- ================= SYNC BUTTON ================= -->
{% if request.user.userprofile.role.name|lower in "teacher hod admin" %}
<form method="post"
      action="{% url 'sync_student_external_profiles' student.id %}"
      class="mb-4">
  {% csrf_token %}
  <button class="btn btn-warning"
          onclick="this.disabled=true; this.innerText='Syncingâ€¦ Please wait';">
    ðŸ”„ Sync External Profiles
  </button>
</form>
{% endif %}

<!-- ================= INTERNAL PERFORMANCE ================= -->
<div class="card mb-4">
  <div class="card-header">Internal Performance</div>
  <div class="card-body">
    <p><strong>Total Score:</strong> {{ performance.internal_score }}</p>
    <p><strong>Assessment Score:</strong> {{ performance.assessment_score }}</p>
    <p><strong>Quiz Score:</strong> {{ performance.quiz_score }}</p>
  </div>
</div>

<!-- ================= CODEFORCES ================= -->
{% if performance.external.codeforces %}
<div class="card mb-4">
  <div class="card-header">Codeforces</div>
  <div class="card-body">
    <ul>
      <li><strong>Handle:</strong> {{ performance.external.codeforces.handle }}</li>
      <li><strong>Rating:</strong> {{ performance.external.codeforces.rating }}</li>
      <li><strong>Max Rating:</strong> {{ performance.external.codeforces.max_rating }}</li>
      <li><strong>Rank:</strong> {{ performance.external.codeforces.rank }}</li>
      <li><strong>Total Problems Solved:</strong>
          {{ performance.external.codeforces.total_problems_solved }}</li>
      <li><strong>Accepted Submissions:</strong>
          {{ performance.external.codeforces.accepted_submissions }}</li>
      <li><strong>Contests Participated:</strong>
          {{ performance.external.codeforces.contests_participated }}</li>
    </ul>

    <h6>Languages Used</h6>
    <ul>
      {% for lang, count in performance.external.codeforces.languages.items %}
        <li>{{ lang }} â€” {{ count }}</li>
      {% empty %}
        <li>No language data available</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}

<!-- ================= LEETCODE ================= -->
{% if performance.external.leetcode %}
<div class="card mb-4">
  <div class="card-header">LeetCode</div>
  <div class="card-body">
    <ul>
      <li><strong>Total Solved:</strong>
          {{ performance.external.leetcode.total_solved }}</li>
      <li><strong>Easy:</strong>
          {{ performance.external.leetcode.easy_solved }}</li>
      <li><strong>Medium:</strong>
          {{ performance.external.leetcode.medium_solved }}</li>
      <li><strong>Hard:</strong>
          {{ performance.external.leetcode.hard_solved }}</li>
      <li><strong>Ranking:</strong>
          {{ performance.external.leetcode.ranking }}</li>
    </ul>
  </div>
</div>
{% endif %}

<!-- ================= CODECHEF ================= -->
{% if performance.external.codechef %}
<div class="card mb-4">
  <div class="card-header">CodeChef</div>
  <div class="card-body">
    <ul>
      <li><strong>Rating:</strong>
          {{ performance.external.codechef.rating }}</li>
      <li><strong>Highest Rating:</strong>
          {{ performance.external.codechef.highest_rating }}</li>
      <li><strong>Stars:</strong>
          {{ performance.external.codechef.stars }}</li>
      <li><strong>Global Rank:</strong>
          {{ performance.external.codechef.global_rank }}</li>
      <li><strong>Country Rank:</strong>
          {{ performance.external.codechef.country_rank }}</li>
      <li><strong>Problems Solved:</strong>
          {{ performance.external.codechef.problems_solved }}</li>
    </ul>
  </div>
</div>
{% endif %}

<!-- ================= HACKERRANK ================= -->
{% if performance.external.hackerrank %}
<div class="card mb-4">
  <div class="card-header">HackerRank</div>
  <div class="card-body">
    <p>
      <strong>Username:</strong>
      {{ performance.external.hackerrank.username }}
    </p>

    <a href="{{ performance.external.hackerrank.profile_url }}"
       target="_blank"
       class="btn btn-outline-success">
      View Badges on HackerRank
    </a>

    <p class="text-muted mt-2">
      Badges are displayed directly on HackerRank for accuracy.
    </p>
  </div>
</div>
{% endif %}

<!-- ================= ASSESSMENTS ================= -->
<div class="card mb-4">
  <div class="card-header">Assessments Attempted</div>
  <div class="card-body">
    {% if performance.assessments %}
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Assessment</th>
            <th>Score</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for a in performance.assessments %}
          <tr>
            <td>{{ a.name }}</td>
            <td>{{ a.score }}</td>
            <td>{{ a.date|date:"d M Y H:i" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No assessments attempted.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
