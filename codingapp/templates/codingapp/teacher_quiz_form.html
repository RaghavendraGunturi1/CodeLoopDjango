{% extends "codingapp/base.html" %}
{% load static %}
{% block content %}

<h2>{{ action }} Quiz</h2>

<form method="post" enctype="multipart/form-data" class="mb-4">
    {% csrf_token %}

    <!-- QUIZ DETAILS SECTION -->
    <h4 class="mt-3">Quiz Details</h4>
    <div class="card p-3 mb-4">
        {{ form.as_p }}
    </div>

    <!-- BULK UPLOAD SECTION -->
    <h4 class="mt-3">Bulk MCQ Upload (Excel / CSV)</h4>

    <div class="card p-3 mb-4">
        <label for="bulk_file" class="form-label fw-bold">Choose File to Upload Questions</label>

        <!-- Always visible file input -->
        <input type="file"
               name="bulk_file"
               id="bulk_file"
               accept=".xlsx,.xls,.csv"
               class="form-control border border-dark mb-3"
               style="background:white !important; color:black !important; display:block !important;">

        <!-- Upload button for bulk questions -->
        <button type="submit"
                name="upload_questions"
                value="1"
                class="btn btn-primary"
                style="display:inline-block !important;">
            Upload Questions
        </button>

        <div class="mt-3">
            <strong>Required Columns:</strong><br>
            <code>
                Question Text, Option1, Option2, Option3, Option4, Correct Answer, Description
            </code>

            <p class="mt-2">
                <a href="{% static 'samples/sample_mcq_upload.xlsx' %}"
                   class="btn btn-outline-secondary btn-sm"
                   download>
                    Download Sample Template
                </a>
            </p>
        </div>
    </div>

    <!-- CREATE QUIZ BUTTON -->
    <button type="submit" class="btn btn-success btn-lg">
        Save Quiz
    </button>

    <a href="{% url 'teacher_quiz_list' %}" class="btn btn-secondary btn-lg ms-2">Cancel</a>
</form>

<hr>

<!-- RESULT SUMMARY -->
{% if result %}
    <h3>Upload Summary</h3>
    <ul>
        <li>Created: {{ result.created }}</li>
        <li>Skipped: {{ result.skipped }}</li>
        <li>Errors: {{ result.errors|length }}</li>
    </ul>

    {% if result.errors %}
        <h4>Error Details</h4>
        <ul>
            {% for e in result.errors %}
                <li class="text-danger">{{ e }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endif %}

{% endblock %}
